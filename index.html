<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë¯¸ë‹ˆë©€ ë§í¬ ëŒ€ì‹œë³´ë“œ</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#ffffff" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />

  <!-- Minimal white brand favicon (SVG data URI) -->
  <link rel="icon" type="image/svg+xml"
    href='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="128" height="128"%3E%3Crect width="128" height="128" rx="28" fill="%23ffffff"/%3E%3Cpath d="M36 40h56v10H36zM36 59h40v10H36zM36 78h56v10H36z" fill="%23111827"/%3E%3C/svg%3E' />

  <style>
    :root{
      --bg:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --card:#ffffff;
      --hover:#f9fafb;
      --chip:#f3f4f6;
      --shadow: 0 10px 30px rgba(17,24,39,.06);
      --radius:16px;
      --max:1100px;

      --warn:#ef4444;
      --gold:#f59e0b;
      --ok:#10b981;
    }

    /* âœ… Dark mode variables (body.dark overrides) */
    body.dark{
      --bg:#0b1220;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --line:#1f2937;
      --card:#0f172a;
      --hover:#111c33;
      --chip:#111827;
      --shadow: 0 10px 30px rgba(0,0,0,.35);

      --warn:#f87171;
      --gold:#fbbf24;
      --ok:#34d399;
    }
    body.dark .modalBack{ background: rgba(0,0,0,.55); }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    .wrap{
      max-width:var(--max);
      margin:0 auto;
      padding:32px 18px 56px;
    }

    /* Header */
    .top{
      display:flex;
      flex-direction:column;
      gap:12px;
      margin-bottom:14px;
    }
    .brand{min-width:0}
    .brand h1{
      font-size:30px;
      letter-spacing:-0.02em;
      margin:0 0 6px 0;
      line-height:1.15;

      white-space:normal;
      overflow:visible;
      text-overflow:clip;
      word-break:keep-all;
    }
    .brand p{
      margin:0;
      color:var(--muted);
      line-height:1.5;
      font-size:14px;
    }

    /* actions */
    .actions{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .btn{
      border:1px solid var(--line);
      background:var(--card);
      padding:10px 12px;
      border-radius:12px;
      font-weight:900;
      font-size:13px;
      cursor:pointer;
      color:var(--text);
      white-space:nowrap;
    }
    .btn:hover{background:var(--hover);}
    .btn.primary{
      border-color: rgba(16,185,129,.35);
      background: rgba(16,185,129,.10);
    }
    .btn.danger{
      border-color: rgba(239,68,68,.35);
      background: rgba(239,68,68,.08);
    }
    /* âœ… theme toggle pinned to right edge of actions row */
    .btn.themeToggle{
      margin-left:auto;
      font-weight:950;
    }

    /* Search rows */
    .searchRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top:12px;
    }
    .search{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px 12px;
      display:flex;
      gap:10px;
      align-items:center;
      background:var(--card);
      box-shadow: var(--shadow);
    }
    .search .icon{
      width:36px;height:36px;border-radius:12px;
      background:var(--chip);
      display:flex;align-items:center;justify-content:center;
      color:var(--muted);
      font-weight:950;
      flex:0 0 auto;
    }
    .search input{
      border:0;
      outline:none;
      width:100%;
      font-size:15px;
      background:transparent;
      color:var(--text);
    }

    .hint{
      color:var(--muted);
      font-size:12px;
      margin-top:10px;
      line-height:1.5;
    }

    /* Favorites */
    .favBox{
      margin-top:14px;
      border:1px solid var(--line);
      border-radius:16px;
      background:var(--card);
      box-shadow: var(--shadow);
      padding:14px;
    }
    .favTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
      flex-wrap:wrap;
    }
    .favTitle{
      font-weight:950;
      letter-spacing:-0.01em;
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .pill{
      font-size:12px;
      font-weight:950;
      border:1px solid var(--line);
      background:var(--chip);
      padding:6px 10px;
      border-radius:999px;
      color:var(--text);
      flex:0 0 auto;
    }
    .favHelp{
      color:var(--muted);
      font-size:12px;
      line-height:1.4;
    }
    .favGrid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap:10px;
      margin-top:10px;
    }
    .favItem{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px 12px;
      background:var(--card);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      min-height:54px;
    }
    .favItem[draggable="true"]{cursor:grab;}
    .favItem.dragging{opacity:.55;}
    .favItem.dragover{
      outline: 2px dashed rgba(16,185,129,.65);
      outline-offset: 2px;
    }
    .favLeft{
      min-width:0;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .favLink{
      text-decoration:none;
      color:var(--text);
      font-weight:900;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:100%;
      display:block;
    }
    .favMeta{
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:100%;
    }
    .iconBtn{
      width:34px;height:34px;
      border-radius:12px;
      border:1px solid var(--line);
      background:var(--chip);
      cursor:pointer;
      font-weight:950;
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      user-select:none;
      flex:0 0 auto;
    }
    .iconBtn:hover{background:var(--hover);}
    .iconBtn.danger{color:var(--warn);}

    /* Categories */
    .cats{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin:16px 0 12px;
    }
    .chipbtn{
      border:1px solid var(--line);
      background:var(--chip);
      padding:8px 12px;
      border-radius:999px;
      font-size:13px;
      font-weight:950;
      color:var(--text);
      cursor:pointer;
      user-select:none;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .chipbtn:hover{background:var(--hover);}
    .chipbtn.active{
      background:var(--text);
      color:var(--bg);
      border-color:var(--text);
    }
    .count{
      font-size:12px;
      font-weight:950;
      opacity:.75;
    }

    /* Grid cards */
    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap:14px;
      margin-top:12px;
    }

    .card{
      display:grid;
      grid-template-columns: 1fr auto auto;
      align-items:center;
      gap:10px;
      padding:16px;
      border-radius:var(--radius);
      border:1px solid var(--line);
      background:var(--card);
      text-decoration:none;
      color:var(--text);
      transition: transform .12s ease, background .12s ease, box-shadow .12s ease;
      min-height:86px;
      box-shadow: 0 0 0 rgba(0,0,0,0);
    }
    .card:hover{
      background:var(--hover);
      transform: translateY(-1px);
      box-shadow: 0 14px 28px rgba(17,24,39,.08);
    }
    .card[draggable="true"]{cursor:grab;}
    .card.dragging{opacity:.55; transform:none;}
    .card.dragover{
      outline: 2px dashed rgba(16,185,129,.65);
      outline-offset: 2px;
    }

    .left{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:0;
    }
    .title{
      font-weight:980;
      letter-spacing:-0.01em;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .sub{
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .metaRow{
      display:flex;
      gap:8px;
      align-items:center;
      min-width:0;
    }
    .badge{
      flex:0 0 auto;
      font-size:12px;
      font-weight:950;
      color:var(--text);
      background:var(--chip);
      border:1px solid var(--line);
      padding:6px 10px;
      border-radius:999px;
      max-width: 100%;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .star,
    .menu{
      position:static;
      width:34px;height:34px;
      border-radius:12px;
      border:1px solid var(--line);
      background:var(--chip);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:980;
      user-select:none;
      color:var(--muted);
    }
    .star:hover,.menu:hover{background:var(--hover);}
    .star.on{
      color:var(--gold);
      border-color: rgba(245, 158, 11, .35);
    }
    .menu.hidden{display:none;}

    /* Modal */
    .modalBack{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.35);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:50;
    }
    .modal{
      width:min(560px, 100%);
      background:var(--card);
      border:1px solid var(--line);
      border-radius:18px;
      box-shadow: var(--shadow);
      padding:16px;
    }
    .modalHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .modalTitle{font-weight:980; letter-spacing:-0.01em;}
    .form{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:10px;
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .field label{
      font-size:12px;
      color:var(--muted);
      font-weight:900;
    }
    .field input, .field select, .field textarea{
      border:1px solid var(--line);
      background:var(--bg);
      color:var(--text);
      border-radius:12px;
      padding:12px 12px;
      outline:none;
      font-weight:800;
      font-size:14px;
    }
    .field textarea{
      min-height:140px;
      resize:vertical;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:12px;
      font-weight:700;
      line-height:1.45;
    }
    .row2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .modalActions{
      display:flex;
      gap:10px;
      justify-content:flex-end;
      margin-top:12px;
      flex-wrap:wrap;
    }
    .small{
      font-size:12px;
      color:var(--muted);
      line-height:1.4;
      margin-top:8px;
    }

    footer{
      margin-top:34px;
      padding-top:18px;
      border-top:1px solid var(--line);
      color:var(--muted);
      font-size:12px;
      line-height:1.7;
    }

    @media (max-width:820px){
      .searchRow{grid-template-columns:1fr;}
      .row2{grid-template-columns:1fr;}
      .btn.themeToggle{ margin-left:0; } /* wrap ì‹œ ìì—°ìŠ¤ëŸ½ê²Œ */
    }
    @media (max-width:520px){
      .brand h1{font-size:24px;}
      .grid{grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));}
      .favGrid{grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));}
      .actions{gap:8px;}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <h1>ë¯¸ë‹ˆë©€ ë§í¬ ëŒ€ì‹œë³´ë“œ</h1>
        <p>ë¬´íšŒì› Â· ë¬´ìˆ˜ì§‘ Â· ê°œì¸í™”ëŠ” ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤. (ê³µìœ ëŠ” URLë¡œë§Œ ì „ë‹¬)</p>
      </div>

      <div class="actions">
        <button class="btn primary" id="addBtn" type="button">ë‚´ ë§í¬ ì¶”ê°€</button>
        <button class="btn" id="resetOrderBtn" type="button">ì •ë ¬ ì´ˆê¸°í™”</button>
        <button class="btn" id="exportBtn" type="button">ë‚´ë³´ë‚´ê¸°</button>
        <button class="btn" id="importBtn" type="button">ê°€ì ¸ì˜¤ê¸°</button>
        <button class="btn danger" id="wipeBtn" type="button">ê°œì¸í™” ì´ˆê¸°í™”</button>
        <button class="btn" id="shareBtn" type="button" title="í˜„ì¬ ê°œì¸í™”ë¥¼ URLë¡œ ê³µìœ ">ê³µìœ  ë§í¬(ì••ì¶•)</button>
        <button class="btn" id="installBtn" type="button" style="display:none;">í™ˆí™”ë©´ ì„¤ì¹˜</button>
        <button class="btn" type="button" id="resetBtn">ì´ˆê¸°í™”</button>

        <!-- âœ… ìš°ì¸¡ ìƒë‹¨(ì•¡ì…˜ ì˜ì—­ ì˜¤ë¥¸ìª½)ì— í…Œë§ˆ í† ê¸€ -->
        <button class="btn themeToggle" id="themeToggle" type="button" title="í™”ì´íŠ¸/ë¸”ë™ ì „í™˜">ğŸŒ™ ë‹¤í¬</button>
      </div>
    </div>

    <!-- Two search bars -->
    <div class="searchRow">
      <div class="search" title="ë„¤ì´ë²„ ê²€ìƒ‰ (Enter)">
        <div class="icon">N</div>
        <input id="naverQ" placeholder="ë„¤ì´ë²„ ê²€ìƒ‰ (Enter)" autocomplete="off" />
        <button class="btn" type="button" id="naverGo">ê²€ìƒ‰</button>
      </div>

      <div class="search" title="êµ¬ê¸€ ê²€ìƒ‰ (Enter)">
        <div class="icon">G</div>
        <input id="googleQ" placeholder="êµ¬ê¸€ ê²€ìƒ‰ (Enter)" autocomplete="off" />
        <button class="btn" type="button" id="googleGo">ê²€ìƒ‰</button>
      </div>
    </div>

    <div class="hint">
      â€¢ â­: ì¦ê²¨ì°¾ê¸°(ì¹´í…Œê³ ë¦¬ë³„ ìµœëŒ€ 5) â€¢ ì¦ê²¨ì°¾ê¸°/ì¹´ë“œ ëª¨ë‘ ë“œë˜ê·¸ë¡œ ìˆœì„œ ì €ì¥ â€¢ â‹¯: ë‚´ ë§í¬ í¸ì§‘/ì‚­ì œ â€¢ ê³µìœ  ë§í¬: ì„œë²„ ì—†ì´ URLë¡œ ì „ë‹¬(ì••ì¶•)
    </div>

    <!-- Favorites -->
    <div class="favBox">
      <div class="favTop">
        <div class="favTitle">
          <span>ì¦ê²¨ì°¾ê¸°</span>
          <span class="pill" id="favScope">ì „ì²´</span>
        </div>
        <div class="favHelp">í˜„ì¬ ì¹´í…Œê³ ë¦¬ ê¸°ì¤€ ì €ì¥ (ë“œë˜ê·¸ë¡œ ìˆœì„œ ë³€ê²½)</div>
      </div>
      <div class="favGrid" id="favGrid"></div>
    </div>

    <!-- Categories -->
    <div class="cats" id="cats">
      <div class="chipbtn active" data-cat="all">ì „ì²´ <span class="count" data-count="all">(0)</span></div>
      <div class="chipbtn" data-cat="comm">ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ <span class="count" data-count="comm">(0)</span></div>
      <div class="chipbtn" data-cat="prod">ìƒì‚°ì„± <span class="count" data-count="prod">(0)</span></div>
      <div class="chipbtn" data-cat="media">ë¯¸ë””ì–´ <span class="count" data-count="media">(0)</span></div>
      <div class="chipbtn" data-cat="finance">ê¸ˆìœµ <span class="count" data-count="finance">(0)</span></div>
      <div class="chipbtn" data-cat="ai">AI <span class="count" data-count="ai">(0)</span></div>
      <div class="chipbtn" data-cat="news">ë‰´ìŠ¤Â·ë¦¬ì„œì¹˜ <span class="count" data-count="news">(0)</span></div>
      <div class="chipbtn" data-cat="shop">ì‡¼í•‘ <span class="count" data-count="shop">(0)</span></div>
      <div class="chipbtn" data-cat="community">ì»¤ë®¤ë‹ˆí‹° <span class="count" data-count="community">(0)</span></div>
      <div class="chipbtn" data-cat="dev">ê°œë°œÂ·ë„êµ¬ <span class="count" data-count="dev">(0)</span></div>
      <div class="chipbtn" data-cat="util">ìœ í‹¸ë¦¬í‹° <span class="count" data-count="util">(0)</span></div>
    </div>

    <!-- Grid -->
    <div class="grid" id="grid"></div>

    <footer>
      ë³¸ ì‚¬ì´íŠ¸ëŠ” ë§í¬ í—ˆë¸Œ(ë¶ë§ˆí¬ ëŒ€ì²´)ì…ë‹ˆë‹¤. ì™¸ë¶€ ì„œë¹„ìŠ¤ì˜ ìƒí‘œ/ìš´ì˜ ê¶Œí•œì€ ê° ì†Œìœ ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.<br/>
      íšŒì›ê°€ì…/ë¡œê·¸ì¸ ì—†ìŒ, ê°œì¸ì •ë³´ ìˆ˜ì§‘/ì €ì¥ ì—†ìŒ. ê°œì¸í™”(ì¦ê²¨ì°¾ê¸°/ì •ë ¬/ë‚´ ë§í¬)ëŠ” ë¸Œë¼ìš°ì €(LocalStorage)ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.
    </footer>
  </div>

  <!-- Modal: add/edit OR import JSON -->
  <div class="modalBack" id="modalBack" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="modalHeader">
        <div class="modalTitle" id="modalTitle">ë‚´ ë§í¬ ì¶”ê°€</div>
        <button class="iconBtn" id="modalClose" type="button" title="ë‹«ê¸°">Ã—</button>
      </div>

      <div class="small" id="modalDesc">í˜„ì¬ ì„ íƒëœ ì¹´í…Œê³ ë¦¬ì— ì €ì¥ë©ë‹ˆë‹¤.</div>

      <!-- Link form -->
      <div id="linkFormArea">
        <div class="form">
          <div class="row2">
            <div class="field">
              <label>ì¹´í…Œê³ ë¦¬</label>
              <select id="fCat">
                <option value="comm">ì»¤ë®¤ë‹ˆì¼€ì´ì…˜</option>
                <option value="prod">ìƒì‚°ì„±</option>
                <option value="media">ë¯¸ë””ì–´</option>
                <option value="finance">ê¸ˆìœµ</option>
                <option value="ai">AI</option>
                <option value="news">ë‰´ìŠ¤Â·ë¦¬ì„œì¹˜</option>
                <option value="shop">ì‡¼í•‘</option>
                <option value="community">ì»¤ë®¤ë‹ˆí‹°</option>
                <option value="dev">ê°œë°œÂ·ë„êµ¬</option>
                <option value="util">ìœ í‹¸ë¦¬í‹°</option>
              </select>
            </div>
            <div class="field">
              <label>ë±ƒì§€(í‘œì‹œ)</label>
              <input id="fBadge" placeholder="ì˜ˆ: ME / PRO / FIN" />
            </div>
          </div>

          <div class="field">
            <label>ì´ë¦„</label>
            <input id="fTitle" placeholder="ì˜ˆ: ë‚´ ì„œë¹„ìŠ¤" />
          </div>

          <div class="field">
            <label>ì„¤ëª…</label>
            <input id="fSub" placeholder="ì˜ˆ: ë©”ëª¨" />
          </div>

          <div class="field">
            <label>URL</label>
            <input id="fHref" placeholder="https://..." />
          </div>
        </div>

        <div class="modalActions">
          <button class="btn danger" id="deleteBtn" type="button" style="display:none;">ì‚­ì œ</button>
          <button class="btn" id="cancelBtn" type="button">ì·¨ì†Œ</button>
          <button class="btn primary" id="saveBtn" type="button">ì €ì¥</button>
        </div>
      </div>

      <!-- Import area -->
      <div id="importArea" style="display:none;">
        <div class="form">
          <div class="field">
            <label>ê°€ì ¸ì˜¤ê¸° JSON</label>
            <textarea id="importText" placeholder='ì—¬ê¸°ì— JSONì„ ë¶™ì—¬ë„£ê³  "ê°€ì ¸ì˜¤ê¸° ì ìš©"ì„ ëˆ„ë¥´ì„¸ìš”.'></textarea>
          </div>
        </div>
        <div class="modalActions">
          <button class="btn" id="importCancelBtn" type="button">ì·¨ì†Œ</button>
          <button class="btn primary" id="applyImportBtn" type="button">ê°€ì ¸ì˜¤ê¸° ì ìš©</button>
        </div>
        <div class="small">ì£¼ì˜: ê¸°ì¡´ ê°œì¸í™”(ë‚´ ë§í¬/ì •ë ¬/ì¦ê²¨ì°¾ê¸°)ë¥¼ ë®ì–´ì”ë‹ˆë‹¤.</div>
      </div>
    </div>
  </div>

  <script>
    // ---------------------------
    // Theme (âœ… White/Black toggle)
    // ---------------------------
    const THEME_KEY = 'xbrand_theme_v1';
    const themeToggle = document.getElementById('themeToggle');

    function applyTheme(mode){
      const isDark = mode === 'dark';
      document.body.classList.toggle('dark', isDark);

      const meta = document.querySelector('meta[name="theme-color"]');
      if(meta) meta.setAttribute('content', isDark ? '#0b1220' : '#ffffff');

      if(themeToggle){
        themeToggle.textContent = isDark ? 'â˜€ï¸ ë¼ì´íŠ¸' : 'ğŸŒ™ ë‹¤í¬';
      }
    }
    function loadTheme(){
      const saved = localStorage.getItem(THEME_KEY);
      if(saved === 'dark' || saved === 'light') return saved;
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      return prefersDark ? 'dark' : 'light';
    }
    function toggleTheme(){
      const nowDark = document.body.classList.contains('dark');
      const next = nowDark ? 'light' : 'dark';
      localStorage.setItem(THEME_KEY, next);
      applyTheme(next);
    }
    if(themeToggle) themeToggle.addEventListener('click', toggleTheme);

    // âœ… ì´ˆê¸° í…Œë§ˆ ì ìš© (í˜ì´ì§€ ë¡œë“œ ì¦‰ì‹œ)
    applyTheme(loadTheme());

    // ---------------------------
    // Keys
    // ---------------------------
    const FAV_KEY = 'xbrand_favorites_v1';
    const ORDER_KEY = 'xbrand_order_v1';
    const CUSTOM_KEY = 'xbrand_custom_links_v1';
    const MAX_FAV = 5;

    // ---------------------------
    // Helpers
    // ---------------------------
    function escapeHtml(str){
      return String(str)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'","&#039;");
    }
    function safeUrl(url){
      try{
        const u = new URL(url);
        if(u.protocol !== 'http:' && u.protocol !== 'https:') return null;
        return u.toString();
      }catch{ return null; }
    }
    function loadJSON(key, fallback){
      try{ return JSON.parse(localStorage.getItem(key) || '') ?? fallback; }
      catch{ return fallback; }
    }
    function saveJSON(key, val){
      localStorage.setItem(key, JSON.stringify(val));
    }
    function uid(){
      return 'id_' + Math.random().toString(16).slice(2) + Date.now().toString(16);
    }
    function chipLabel(cat){
      const map = {
        all:'ì „ì²´', comm:'ì»¤ë®¤ë‹ˆì¼€ì´ì…˜', prod:'ìƒì‚°ì„±', media:'ë¯¸ë””ì–´', finance:'ê¸ˆìœµ', ai:'AI',
        news:'ë‰´ìŠ¤Â·ë¦¬ì„œì¹˜', shop:'ì‡¼í•‘', community:'ì»¤ë®¤ë‹ˆí‹°', dev:'ê°œë°œÂ·ë„êµ¬', util:'ìœ í‹¸ë¦¬í‹°'
      };
      return map[cat] || cat;
    }

    // ---------------------------
    // URL-safe compression (LZ-based)
    // ---------------------------
    const _keyStrUriSafe = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$";
    function _getBaseValue(alphabet, character) { return alphabet.indexOf(character); }
    function compressToEncodedURIComponent(input) {
      if (input == null) return "";
      return _compress(input, 6, (a) => _keyStrUriSafe.charAt(a));
    }
    function decompressFromEncodedURIComponent(input) {
      if (input == null) return "";
      if (input === "") return null;
      return _decompress(input.length, 32, (index) => _getBaseValue(_keyStrUriSafe, input.charAt(index)));
    }
    function _compress(uncompressed, bitsPerChar, getCharFromInt) {
      if (uncompressed == null) return "";
      let i, value;
      const context_dictionary = {};
      const context_dictionaryToCreate = {};
      let context_c = "";
      let context_wc = "";
      let context_w = "";
      let context_enlargeIn = 2;
      let context_dictSize = 3;
      let context_numBits = 2;
      const context_data = [];
      let context_data_val = 0;
      let context_data_position = 0;

      for (let ii = 0; ii < uncompressed.length; ii += 1) {
        context_c = uncompressed.charAt(ii);
        if (!Object.prototype.hasOwnProperty.call(context_dictionary, context_c)) {
          context_dictionary[context_c] = context_dictSize++;
          context_dictionaryToCreate[context_c] = true;
        }

        context_wc = context_w + context_c;
        if (Object.prototype.hasOwnProperty.call(context_dictionary, context_wc)) {
          context_w = context_wc;
        } else {
          if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate, context_w)) {
            if (context_w.charCodeAt(0) < 256) {
              for (i = 0; i < context_numBits; i++) {
                context_data_val = (context_data_val << 1);
                if (context_data_position == bitsPerChar - 1) {
                  context_data_position = 0;
                  context_data.push(getCharFromInt(context_data_val));
                  context_data_val = 0;
                } else context_data_position++;
              }
              value = context_w.charCodeAt(0);
              for (i = 0; i < 8; i++) {
                context_data_val = (context_data_val << 1) | (value & 1);
                if (context_data_position == bitsPerChar - 1) {
                  context_data_position = 0;
                  context_data.push(getCharFromInt(context_data_val));
                  context_data_val = 0;
                } else context_data_position++;
                value = value >> 1;
              }
            } else {
              value = 1;
              for (i = 0; i < context_numBits; i++) {
                context_data_val = (context_data_val << 1) | value;
                if (context_data_position == bitsPerChar - 1) {
                  context_data_position = 0;
                  context_data.push(getCharFromInt(context_data_val));
                  context_data_val = 0;
                } else context_data_position++;
                value = 0;
              }
              value = context_w.charCodeAt(0);
              for (i = 0; i < 16; i++) {
                context_data_val = (context_data_val << 1) | (value & 1);
                if (context_data_position == bitsPerChar - 1) {
                  context_data_position = 0;
                  context_data.push(getCharFromInt(context_data_val));
                  context_data_val = 0;
                } else context_data_position++;
                value = value >> 1;
              }
            }
            context_enlargeIn--;
            if (context_enlargeIn == 0) {
              context_enlargeIn = Math.pow(2, context_numBits);
              context_numBits++;
            }
            delete context_dictionaryToCreate[context_w];
          } else {
            value = context_dictionary[context_w];
            for (i = 0; i < context_numBits; i++) {
              context_data_val = (context_data_val << 1) | (value & 1);
              if (context_data_position == bitsPerChar - 1) {
                context_data_position = 0;
                context_data.push(getCharFromInt(context_data_val));
                context_data_val = 0;
              } else context_data_position++;
              value = value >> 1;
            }
          }
          context_enlargeIn--;
          if (context_enlargeIn == 0) {
            context_enlargeIn = Math.pow(2, context_numBits);
            context_numBits++;
          }
          context_dictionary[context_wc] = context_dictSize++;
          context_w = String(context_c);
        }
      }

      if (context_w !== "") {
        if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate, context_w)) {
          if (context_w.charCodeAt(0) < 256) {
            for (i = 0; i < context_numBits; i++) {
              context_data_val = (context_data_val << 1);
              if (context_data_position == bitsPerChar - 1) {
                context_data_position = 0;
                context_data.push(getCharFromInt(context_data_val));
                context_data_val = 0;
              } else context_data_position++;
            }
            value = context_w.charCodeAt(0);
            for (i = 0; i < 8; i++) {
              context_data_val = (context_data_val << 1) | (value & 1);
              if (context_data_position == bitsPerChar - 1) {
                context_data_position = 0;
                context_data.push(getCharFromInt(context_data_val));
                context_data_val = 0;
              } else context_data_position++;
              value = value >> 1;
            }
          } else {
            value = 1;
            for (i = 0; i < context_numBits; i++) {
              context_data_val = (context_data_val << 1) | value;
              if (context_data_position == bitsPerChar - 1) {
                context_data_position = 0;
                context_data.push(getCharFromInt(context_data_val));
                context_data_val = 0;
              } else context_data_position++;
              value = 0;
            }
            value = context_w.charCodeAt(0);
            for (i = 0; i < 16; i++) {
              context_data_val = (context_data_val << 1) | (value & 1);
              if (context_data_position == bitsPerChar - 1) {
                context_data_position = 0;
                context_data.push(getCharFromInt(context_data_val));
                context_data_val = 0;
              } else context_data_position++;
              value = value >> 1;
            }
          }
          context_enlargeIn--;
          if (context_enlargeIn == 0) {
            context_enlargeIn = Math.pow(2, context_numBits);
            context_numBits++;
          }
          delete context_dictionaryToCreate[context_w];
        } else {
          value = context_dictionary[context_w];
          for (i = 0; i < context_numBits; i++) {
            context_data_val = (context_data_val << 1) | (value & 1);
            if (context_data_position == bitsPerChar - 1) {
              context_data_position = 0;
              context_data.push(getCharFromInt(context_data_val));
              context_data_val = 0;
            } else context_data_position++;
            value = value >> 1;
          }
        }
        context_enlargeIn--;
        if (context_enlargeIn == 0) {
          context_enlargeIn = Math.pow(2, context_numBits);
          context_numBits++;
        }
      }

      value = 2;
      for (i = 0; i < context_numBits; i++) {
        context_data_val = (context_data_val << 1) | (value & 1);
        if (context_data_position == bitsPerChar - 1) {
          context_data_position = 0;
          context_data.push(getCharFromInt(context_data_val));
          context_data_val = 0;
        } else context_data_position++;
        value = value >> 1;
      }

      while (true) {
        context_data_val = (context_data_val << 1);
        if (context_data_position == bitsPerChar - 1) {
          context_data.push(getCharFromInt(context_data_val));
          break;
        } else context_data_position++;
      }
      return context_data.join("");
    }

    function _decompress(length, resetValue, getNextValue) {
      const dictionary = [];
      let next;
      let enlargeIn = 4;
      let dictSize = 4;
      let numBits = 3;
      let entry = "";
      const result = [];
      let i;
      let w;
      let bits, resb, maxpower, power;
      let c;
      const data = { val: getNextValue(0), position: resetValue, index: 1 };

      for (i = 0; i < 3; i += 1) dictionary[i] = i;

      bits = 0; maxpower = Math.pow(2, 2); power = 1;
      while (power != maxpower) {
        resb = data.val & data.position;
        data.position >>= 1;
        if (data.position == 0) { data.position = resetValue; data.val = getNextValue(data.index++); }
        bits |= (resb > 0 ? 1 : 0) * power;
        power <<= 1;
      }

      switch (next = bits) {
        case 0:
          bits = 0; maxpower = Math.pow(2, 8); power = 1;
          while (power != maxpower) {
            resb = data.val & data.position;
            data.position >>= 1;
            if (data.position == 0) { data.position = resetValue; data.val = getNextValue(data.index++); }
            bits |= (resb > 0 ? 1 : 0) * power;
            power <<= 1;
          }
          c = String.fromCharCode(bits);
          break;
        case 1:
          bits = 0; maxpower = Math.pow(2, 16); power = 1;
          while (power != maxpower) {
            resb = data.val & data.position;
            data.position >>= 1;
            if (data.position == 0) { data.position = resetValue; data.val = getNextValue(data.index++); }
            bits |= (resb > 0 ? 1 : 0) * power;
            power <<= 1;
          }
          c = String.fromCharCode(bits);
          break;
        case 2:
          return "";
      }

      dictionary[3] = c;
      w = c;
      result.push(c);

      while (true) {
        if (data.index > length) return "";

        bits = 0; maxpower = Math.pow(2, numBits); power = 1;
        while (power != maxpower) {
          resb = data.val & data.position;
          data.position >>= 1;
          if (data.position == 0) { data.position = resetValue; data.val = getNextValue(data.index++); }
          bits |= (resb > 0 ? 1 : 0) * power;
          power <<= 1;
        }

        switch (c = bits) {
          case 0:
            bits = 0; maxpower = Math.pow(2, 8); power = 1;
            while (power != maxpower) {
              resb = data.val & data.position;
              data.position >>= 1;
              if (data.position == 0) { data.position = resetValue; data.val = getNextValue(data.index++); }
              bits |= (resb > 0 ? 1 : 0) * power;
              power <<= 1;
            }
            dictionary[dictSize++] = String.fromCharCode(bits);
            c = dictSize - 1;
            enlargeIn--;
            break;
          case 1:
            bits = 0; maxpower = Math.pow(2, 16); power = 1;
            while (power != maxpower) {
              resb = data.val & data.position;
              data.position >>= 1;
              if (data.position == 0) { data.position = resetValue; data.val = getNextValue(data.index++); }
              bits |= (resb > 0 ? 1 : 0) * power;
              power <<= 1;
            }
            dictionary[dictSize++] = String.fromCharCode(bits);
            c = dictSize - 1;
            enlargeIn--;
            break;
          case 2:
            return result.join("");
        }

        if (enlargeIn == 0) { enlargeIn = Math.pow(2, numBits); numBits++; }

        if (dictionary[c]) entry = dictionary[c];
        else {
          if (c === dictSize) entry = w + w.charAt(0);
          else return null;
        }
        result.push(entry);

        dictionary[dictSize++] = w + entry.charAt(0);
        enlargeIn--;
        w = entry;

        if (enlargeIn == 0) { enlargeIn = Math.pow(2, numBits); numBits++; }
      }
    }

    // ---------------------------
    // Base links (ì¶”ì²œ)
    // ---------------------------
    const BASE = [
      // comm (10)
      {id:'b_comm_1',cat:'comm',title:'Telegram Web',sub:'ë©”ì‹ ì €',href:'https://web.telegram.org',badge:'COMM'},
      {id:'b_comm_2',cat:'comm',title:'Discord',sub:'ì»¤ë®¤ë‹ˆí‹°/ì±„íŒ…',href:'https://discord.com/app',badge:'COMM'},
      {id:'b_comm_3',cat:'comm',title:'Slack',sub:'ì—…ë¬´ ë©”ì‹ ì €',href:'https://slack.com/signin',badge:'COMM'},
      {id:'b_comm_4',cat:'comm',title:'Gmail',sub:'ë©”ì¼',href:'https://mail.google.com',badge:'COMM'},
      {id:'b_comm_5',cat:'comm',title:'Blind',sub:'ì§ì¥ì¸',href:'https://www.blind.com',badge:'COMM'},
      {id:'b_comm_6',cat:'comm',title:'DCInside',sub:'ì»¤ë®¤ë‹ˆí‹°',href:'https://www.dcinside.com',badge:'COMM'},
      {id:'b_comm_7',cat:'comm',title:'Kakao OpenChat',sub:'ì˜¤í”ˆì±„íŒ…',href:'https://open.kakao.com',badge:'COMM'},
      {id:'b_comm_8',cat:'comm',title:'Naver',sub:'í¬í„¸',href:'https://www.naver.com',badge:'COMM'},
      {id:'b_comm_9',cat:'comm',title:'Google Account',sub:'ê³„ì •',href:'https://accounts.google.com',badge:'COMM'},
      {id:'b_comm_10',cat:'comm',title:'Facebook Messages',sub:'ë©”ì‹ ì €',href:'https://www.facebook.com/messages',badge:'COMM'},

      // prod (10)
      {id:'b_prod_1',cat:'prod',title:'Notion',sub:'ë¬¸ì„œ Â· ìœ„í‚¤',href:'https://www.notion.so',badge:'PROD'},
      {id:'b_prod_2',cat:'prod',title:'Google Docs',sub:'ë¬¸ì„œ',href:'https://docs.google.com',badge:'PROD'},
      {id:'b_prod_3',cat:'prod',title:'Google Sheets',sub:'ìŠ¤í”„ë ˆë“œì‹œíŠ¸',href:'https://sheets.google.com',badge:'PROD'},
      {id:'b_prod_4',cat:'prod',title:'Google Drive',sub:'íŒŒì¼',href:'https://drive.google.com',badge:'PROD'},
      {id:'b_prod_5',cat:'prod',title:'Google Calendar',sub:'ì¼ì •',href:'https://calendar.google.com',badge:'PROD'},
      {id:'b_prod_6',cat:'prod',title:'Microsoft Excel',sub:'ì—‘ì…€',href:'https://www.microsoft.com/microsoft-365/excel',badge:'PROD'},
      {id:'b_prod_7',cat:'prod',title:'Microsoft 365',sub:'ì˜¤í”¼ìŠ¤',href:'https://www.office.com',badge:'PROD'},
      {id:'b_prod_8',cat:'prod',title:'Figma',sub:'ë””ìì¸',href:'https://www.figma.com',badge:'PROD'},
      {id:'b_prod_9',cat:'prod',title:'Trello',sub:'ì¹¸ë°˜',href:'https://trello.com',badge:'PROD'},
      {id:'b_prod_10',cat:'prod',title:'Canva',sub:'í…œí”Œë¦¿',href:'https://www.canva.com',badge:'PROD'},

      // media (10)
      {id:'b_media_1',cat:'media',title:'YouTube',sub:'ë™ì˜ìƒ',href:'https://www.youtube.com',badge:'MEDIA'},
      {id:'b_media_2',cat:'media',title:'YouTube Music',sub:'ìŒì•…',href:'https://music.youtube.com',badge:'MEDIA'},
      {id:'b_media_3',cat:'media',title:'Netflix',sub:'ìŠ¤íŠ¸ë¦¬ë°',href:'https://www.netflix.com',badge:'MEDIA'},
      {id:'b_media_4',cat:'media',title:'Naver Webtoon',sub:'ì›¹íˆ°',href:'https://comic.naver.com',badge:'MEDIA'},
      {id:'b_media_5',cat:'media',title:'Kakao Webtoon',sub:'ì›¹íˆ°',href:'https://webtoon.kakao.com',badge:'MEDIA'},
      {id:'b_media_6',cat:'media',title:'TVING',sub:'êµ­ë‚´ OTT',href:'https://www.tving.com',badge:'MEDIA'},
      {id:'b_media_7',cat:'media',title:'Wavve',sub:'êµ­ë‚´ OTT',href:'https://www.wavve.com',badge:'MEDIA'},
      {id:'b_media_8',cat:'media',title:'Spotify',sub:'ìŒì•…',href:'https://www.spotify.com',badge:'MEDIA'},
      {id:'b_media_9',cat:'media',title:'Twitch',sub:'ë¼ì´ë¸Œ',href:'https://www.twitch.tv',badge:'MEDIA'},
      {id:'b_media_10',cat:'media',title:'Disney+',sub:'ìŠ¤íŠ¸ë¦¬ë°',href:'https://www.disneyplus.com',badge:'MEDIA'},

      // finance (10)
      {id:'b_fin_1',cat:'finance',title:'Naver Finance',sub:'êµ­ë‚´ ì‹œì„¸',href:'https://finance.naver.com',badge:'FIN'},
      {id:'b_fin_2',cat:'finance',title:'TradingView',sub:'ì°¨íŠ¸',href:'https://www.tradingview.com',badge:'FIN'},
      {id:'b_fin_3',cat:'finance',title:'Bitget',sub:'ê±°ë˜ì†Œ',href:'https://www.bitget.com',badge:'FIN'},
      {id:'b_fin_4',cat:'finance',title:'Binance',sub:'ê±°ë˜ì†Œ',href:'https://www.binance.com',badge:'FIN'},
      {id:'b_fin_5',cat:'finance',title:'CoinMarketCap',sub:'ì‹œì´',href:'https://www.coinmarketcap.com',badge:'FIN'},
      {id:'b_fin_6',cat:'finance',title:'CoinGecko',sub:'ë°ì´í„°',href:'https://www.coingecko.com',badge:'FIN'},
      {id:'b_fin_7',cat:'finance',title:'Google Finance',sub:'ì‹œì¥',href:'https://www.google.com/finance',badge:'FIN'},
      {id:'b_fin_8',cat:'finance',title:'Investing',sub:'ë°ì´í„°',href:'https://www.investing.com',badge:'FIN'},
      {id:'b_fin_9',cat:'finance',title:'Toss',sub:'ê¸ˆìœµ',href:'https://www.toss.im',badge:'FIN'},
      {id:'b_fin_10',cat:'finance',title:'KakaoBank',sub:'ì€í–‰',href:'https://www.kakaobank.com',badge:'FIN'},

      // ai (10)
      {id:'b_ai_1',cat:'ai',title:'ChatGPT',sub:'ëŒ€í™”í˜• AI',href:'https://chat.openai.com',badge:'AI'},
      {id:'b_ai_2',cat:'ai',title:'Claude',sub:'ëŒ€í™”í˜• AI',href:'https://claude.ai',badge:'AI'},
      {id:'b_ai_3',cat:'ai',title:'Gemini',sub:'êµ¬ê¸€ AI',href:'https://gemini.google.com',badge:'AI'},
      {id:'b_ai_4',cat:'ai',title:'Perplexity',sub:'AI ê²€ìƒ‰',href:'https://www.perplexity.ai',badge:'AI'},
      {id:'b_ai_5',cat:'ai',title:'OpenAI Platform',sub:'API',href:'https://platform.openai.com',badge:'AI'},
      {id:'b_ai_6',cat:'ai',title:'Hugging Face',sub:'ëª¨ë¸/ë°ì´í„°',href:'https://huggingface.co',badge:'AI'},
      {id:'b_ai_7',cat:'ai',title:'GitHub Copilot',sub:'ì½”ë”©',href:'https://copilot.github.com',badge:'AI'},
      {id:'b_ai_8',cat:'ai',title:'Cursor',sub:'AI ì—ë””í„°',href:'https://www.cursor.com',badge:'AI'},
      {id:'b_ai_9',cat:'ai',title:'Midjourney',sub:'ì´ë¯¸ì§€',href:'https://www.midjourney.com',badge:'AI'},
      {id:'b_ai_10',cat:'ai',title:'Recraft',sub:'ë””ìì¸',href:'https://recraft.ai',badge:'AI'},

      // news (10)
      {id:'b_news_1',cat:'news',title:'Naver News',sub:'ë‰´ìŠ¤',href:'https://news.naver.com',badge:'NEWS'},
      {id:'b_news_2',cat:'news',title:'Google News',sub:'ë‰´ìŠ¤',href:'https://news.google.com',badge:'NEWS'},
      {id:'b_news_3',cat:'news',title:'Bloomberg',sub:'ê¸ˆìœµë‰´ìŠ¤',href:'https://www.bloomberg.com',badge:'NEWS'},
      {id:'b_news_4',cat:'news',title:'Reuters',sub:'ê¸€ë¡œë²Œ',href:'https://www.reuters.com',badge:'NEWS'},
      {id:'b_news_5',cat:'news',title:'Financial Times',sub:'ê¸ˆìœµ',href:'https://www.ft.com',badge:'NEWS'},
      {id:'b_news_6',cat:'news',title:'WSJ',sub:'ë¹„ì¦ˆë‹ˆìŠ¤',href:'https://www.wsj.com',badge:'NEWS'},
      {id:'b_news_7',cat:'news',title:'The Economist',sub:'ì‹œì‚¬',href:'https://www.economist.com',badge:'NEWS'},
      {id:'b_news_8',cat:'news',title:'arXiv',sub:'ë…¼ë¬¸',href:'https://arxiv.org',badge:'NEWS'},
      {id:'b_news_9',cat:'news',title:'The Information',sub:'ë¦¬ì„œì¹˜',href:'https://www.theinformation.com',badge:'NEWS'},
      {id:'b_news_10',cat:'news',title:'NYTimes',sub:'ë‰´ìŠ¤',href:'https://www.nytimes.com',badge:'NEWS'},

      // shop (10)
      {id:'b_shop_1',cat:'shop',title:'Coupang',sub:'ì‡¼í•‘',href:'https://www.coupang.com',badge:'SHOP'},
      {id:'b_shop_2',cat:'shop',title:'Naver Shopping',sub:'ê°€ê²©ë¹„êµ',href:'https://shopping.naver.com',badge:'SHOP'},
      {id:'b_shop_3',cat:'shop',title:'11st',sub:'ì‡¼í•‘',href:'https://www.11st.co.kr',badge:'SHOP'},
      {id:'b_shop_4',cat:'shop',title:'Gmarket',sub:'ì‡¼í•‘',href:'https://www.gmarket.co.kr',badge:'SHOP'},
      {id:'b_shop_5',cat:'shop',title:'Auction',sub:'ì‡¼í•‘',href:'https://www.auction.co.kr',badge:'SHOP'},
      {id:'b_shop_6',cat:'shop',title:'SSG',sub:'ì‡¼í•‘',href:'https://www.ssg.com',badge:'SHOP'},
      {id:'b_shop_7',cat:'shop',title:'ì˜¤ëŠ˜ì˜ì§‘',sub:'ë¦¬ë¹™',href:'https://www.todayhouse.com',badge:'SHOP'},
      {id:'b_shop_8',cat:'shop',title:'Amazon',sub:'í•´ì™¸',href:'https://www.amazon.com',badge:'SHOP'},
      {id:'b_shop_9',cat:'shop',title:'AliExpress',sub:'í•´ì™¸',href:'https://www.aliexpress.com',badge:'SHOP'},
      {id:'b_shop_10',cat:'shop',title:'Temu',sub:'í•´ì™¸',href:'https://www.temu.com',badge:'SHOP'},

      // community (10)
      {id:'b_comu_1',cat:'community',title:'FMKOREA',sub:'ì»¤ë®¤ë‹ˆí‹°',href:'https://www.fmkorea.com',badge:'COMM'},
      {id:'b_comu_2',cat:'community',title:'Clien',sub:'ì»¤ë®¤ë‹ˆí‹°',href:'https://www.clien.net',badge:'COMM'},
      {id:'b_comu_3',cat:'community',title:'Ppomppu',sub:'ì»¤ë®¤ë‹ˆí‹°',href:'https://www.ppomppu.co.kr',badge:'COMM'},
      {id:'b_comu_4',cat:'community',title:'Ruliweb',sub:'ì»¤ë®¤ë‹ˆí‹°',href:'https://www.ruliweb.com',badge:'COMM'},
      {id:'b_comu_5',cat:'community',title:'Inven',sub:'ê²Œì„',href:'https://www.inven.co.kr',badge:'COMM'},
      {id:'b_comu_6',cat:'community',title:'DCInside',sub:'ì»¤ë®¤ë‹ˆí‹°',href:'https://www.dcinside.com',badge:'COMM'},
      {id:'b_comu_7',cat:'community',title:'Blind',sub:'ì§ì¥ì¸',href:'https://www.blind.com',badge:'COMM'},
      {id:'b_comu_8',cat:'community',title:'Reddit',sub:'ê¸€ë¡œë²Œ',href:'https://www.reddit.com',badge:'COMM'},
      {id:'b_comu_9',cat:'community',title:'Quora',sub:'Q&A',href:'https://www.quora.com',badge:'COMM'},
      {id:'b_comu_10',cat:'community',title:'Namu Wiki',sub:'ìœ„í‚¤',href:'https://namu.wiki',badge:'COMM'},

      // dev (10)
      {id:'b_dev_1',cat:'dev',title:'GitHub',sub:'ì½”ë“œ',href:'https://github.com',badge:'DEV'},
      {id:'b_dev_2',cat:'dev',title:'Vercel',sub:'ë°°í¬',href:'https://vercel.com',badge:'DEV'},
      {id:'b_dev_3',cat:'dev',title:'Netlify',sub:'ë°°í¬',href:'https://www.netlify.com',badge:'DEV'},
      {id:'b_dev_4',cat:'dev',title:'Google Developers',sub:'ë¬¸ì„œ',href:'https://developers.google.com',badge:'DEV'},
      {id:'b_dev_5',cat:'dev',title:'Stack Overflow',sub:'Q&A',href:'https://stackoverflow.com',badge:'DEV'},
      {id:'b_dev_6',cat:'dev',title:'CodePen',sub:'ì‹¤í—˜',href:'https://codepen.io',badge:'DEV'},
      {id:'b_dev_7',cat:'dev',title:'Replit',sub:'ì½”ë”©',href:'https://replit.com',badge:'DEV'},
      {id:'b_dev_8',cat:'dev',title:'Postman',sub:'API',href:'https://www.postman.com',badge:'DEV'},
      {id:'b_dev_9',cat:'dev',title:'Cloudflare',sub:'CDN',href:'https://cloudflare.com',badge:'DEV'},
      {id:'b_dev_10',cat:'dev',title:'Supabase',sub:'DB/Auth',href:'https://supabase.com',badge:'DEV'},

      // util (10)
      {id:'b_util_1',cat:'util',title:'Google Translate',sub:'ë²ˆì—­',href:'https://translate.google.com',badge:'UTIL'},
      {id:'b_util_2',cat:'util',title:'Google Keep',sub:'ë©”ëª¨',href:'https://keep.google.com',badge:'UTIL'},
      {id:'b_util_3',cat:'util',title:'Google Calendar',sub:'ì¼ì •',href:'https://calendar.google.com',badge:'UTIL'},
      {id:'b_util_4',cat:'util',title:'Naver Map',sub:'ì§€ë„',href:'https://map.naver.com',badge:'UTIL'},
      {id:'b_util_5',cat:'util',title:'Kakao Map',sub:'ì§€ë„',href:'https://map.kakao.com',badge:'UTIL'},
      {id:'b_util_6',cat:'util',title:'Naver Weather',sub:'ë‚ ì”¨',href:'https://weather.naver.com',badge:'UTIL'},
      {id:'b_util_7',cat:'util',title:'Speedtest',sub:'ì†ë„',href:'https://www.speedtest.net',badge:'UTIL'},
      {id:'b_util_8',cat:'util',title:'Time & Date',sub:'ì‹œê°„',href:'https://www.timeanddate.com',badge:'UTIL'},
      {id:'b_util_9',cat:'util',title:'remove.bg',sub:'ë°°ê²½ ì œê±°',href:'https://www.remove.bg',badge:'UTIL'},
      {id:'b_util_10',cat:'util',title:'Google Drive',sub:'ë“œë¼ì´ë¸Œ',href:'https://drive.google.com',badge:'UTIL'},
    ];

    // ---------------------------
    // DOM refs
    // ---------------------------
    const resetBtn = document.getElementById('resetBtn');
    const resetOrderBtn = document.getElementById('resetOrderBtn');
    const wipeBtn = document.getElementById('wipeBtn');
    const addBtn = document.getElementById('addBtn');
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');
    const shareBtn = document.getElementById('shareBtn');
    const installBtn = document.getElementById('installBtn');

    const naverQ = document.getElementById('naverQ');
    const googleQ = document.getElementById('googleQ');
    const naverGo = document.getElementById('naverGo');
    const googleGo = document.getElementById('googleGo');

    const chips = Array.from(document.querySelectorAll('.chipbtn'));
    const grid = document.getElementById('grid');
    const favGrid = document.getElementById('favGrid');
    const favScope = document.getElementById('favScope');

    // Modal refs
    const modalBack = document.getElementById('modalBack');
    const modalTitle = document.getElementById('modalTitle');
    const modalDesc = document.getElementById('modalDesc');
    const modalClose = document.getElementById('modalClose');
    const cancelBtn = document.getElementById('cancelBtn');
    const saveBtn = document.getElementById('saveBtn');
    const deleteBtn = document.getElementById('deleteBtn');

    const linkFormArea = document.getElementById('linkFormArea');
    const importArea = document.getElementById('importArea');
    const importText = document.getElementById('importText');
    const importCancelBtn = document.getElementById('importCancelBtn');
    const applyImportBtn = document.getElementById('applyImportBtn');

    const fCat = document.getElementById('fCat');
    const fBadge = document.getElementById('fBadge');
    const fTitle = document.getElementById('fTitle');
    const fSub = document.getElementById('fSub');
    const fHref = document.getElementById('fHref');

    // ---------------------------
    // State
    // ---------------------------
    let currentCat = 'all';
    let editingId = null;

    // ---------------------------
    // Search
    // ---------------------------
    function openNaver(){
      const q = (naverQ.value || '').trim();
      if(!q) return;
      window.open(`https://search.naver.com/search.naver?query=${encodeURIComponent(q)}`, '_blank', 'noopener');
    }
    function openGoogle(){
      const q = (googleQ.value || '').trim();
      if(!q) return;
      window.open(`https://www.google.com/search?q=${encodeURIComponent(q)}`, '_blank', 'noopener');
    }
    naverGo.addEventListener('click', openNaver);
    googleGo.addEventListener('click', openGoogle);
    naverQ.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') openNaver(); });
    googleQ.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') openGoogle(); });

    // ---------------------------
    // Favorites
    // ---------------------------
    function getFavData(){ return loadJSON(FAV_KEY, {}); }
    function setFavData(data){ saveJSON(FAV_KEY, data); }
    function getFavList(cat){
      const data = getFavData();
      return Array.isArray(data[cat]) ? data[cat] : [];
    }
    function setFavList(cat, list){
      const data = getFavData();
      data[cat] = list;
      setFavData(data);
    }
    function isFav(cat, href){
      return getFavList(cat).some(x => x.href === href);
    }
    function toggleFav(cat, item){
      const list = getFavList(cat);
      const idx = list.findIndex(x => x.href === item.href);

      if(idx >= 0){
        list.splice(idx, 1);
        setFavList(cat, list);
      }else{
        list.unshift(item);
        const seen = new Set();
        const deduped = [];
        for(const x of list){
          if(seen.has(x.href)) continue;
          seen.add(x.href);
          deduped.push(x);
        }
        while(deduped.length > MAX_FAV) deduped.pop();
        setFavList(cat, deduped);
      }
      renderFav();
      syncStars();
    }
    function removeFav(cat, href){
      const list = getFavList(cat).filter(x => x.href !== href);
      setFavList(cat, list);
      renderFav();
      syncStars();
    }
    function persistFavOrderFromDOM(){
      const cat = currentCat;
      const hrefs = Array.from(favGrid.querySelectorAll('.favItem'))
        .map(el => el.dataset.href)
        .filter(Boolean);
      const list = getFavList(cat);
      const map = new Map(list.map(x => [x.href, x]));
      const ordered = [];
      hrefs.forEach(h => { if(map.has(h)) ordered.push(map.get(h)); });
      list.forEach(x => { if(!hrefs.includes(x.href)) ordered.push(x); });
      setFavList(cat, ordered);
    }
    function renderFav(){
      const cat = currentCat;
      const list = getFavList(cat);

      favGrid.innerHTML = '';
      if(list.length === 0){
        favGrid.innerHTML = `
          <div class="favItem" style="grid-column:1/-1; justify-content:flex-start;">
            <div class="favLeft">
              <div class="favLink">ë¹„ì–´ìˆìŒ</div>
              <div class="favMeta">ì•„ë˜ ì¹´ë“œì˜ â­ë¥¼ ëˆŒëŸ¬ ì¦ê²¨ì°¾ê¸°ë¥¼ ì¶”ê°€í•˜ì„¸ìš”. (ì¹´í…Œê³ ë¦¬ë³„ ìµœëŒ€ ${MAX_FAV}ê°œ)</div>
            </div>
          </div>
        `;
        return;
      }

      list.forEach(item => {
        const div = document.createElement('div');
        div.className = 'favItem';
        div.setAttribute('draggable','true');
        div.dataset.href = item.href;
        div.innerHTML = `
          <div class="favLeft">
            <a class="favLink" href="${item.href}" target="_blank" rel="noopener">${escapeHtml(item.title)}</a>
            <div class="favMeta">${escapeHtml(item.sub || '')}</div>
          </div>
          <button class="iconBtn danger" title="ì‚­ì œ">Ã—</button>
        `;
        div.querySelector('.iconBtn').addEventListener('click', () => removeFav(cat, item.href));
        favGrid.appendChild(div);
      });

      enableFavDrag();
    }
    function enableFavDrag(){
      const items = Array.from(favGrid.querySelectorAll('.favItem'));
      let draggingEl = null;

      items.forEach(el => {
        el.addEventListener('dragstart', (e) => {
          draggingEl = el;
          el.classList.add('dragging');
          e.dataTransfer.effectAllowed = 'move';
          e.dataTransfer.setData('text/plain', el.dataset.href || '');
        });
        el.addEventListener('dragend', () => {
          el.classList.remove('dragging');
          items.forEach(x => x.classList.remove('dragover'));
          draggingEl = null;
          persistFavOrderFromDOM();
        });
        el.addEventListener('dragover', (e) => {
          e.preventDefault();
          if(!draggingEl || draggingEl === el) return;
          el.classList.add('dragover');
        });
        el.addEventListener('dragleave', () => el.classList.remove('dragover'));
        el.addEventListener('drop', (e) => {
          e.preventDefault();
          el.classList.remove('dragover');
          if(!draggingEl || draggingEl === el) return;

          const rect = el.getBoundingClientRect();
          const after = (e.clientY - rect.top) > (rect.height / 2);

          if(after) el.insertAdjacentElement('afterend', draggingEl);
          else el.insertAdjacentElement('beforebegin', draggingEl);
        });
      });
    }

    // ---------------------------
    // Custom links
    // ---------------------------
    function loadCustom(){ return loadJSON(CUSTOM_KEY, []); }
    function saveCustom(arr){ saveJSON(CUSTOM_KEY, arr); }
    function upsertCustom(item){
      const arr = loadCustom();
      const idx = arr.findIndex(x => x.id === item.id);
      if(idx >= 0) arr[idx] = item;
      else arr.unshift(item);
      saveCustom(arr);
    }
    function deleteCustom(id){
      saveCustom(loadCustom().filter(x => x.id !== id));
    }

    // ---------------------------
    // Order per category
    // ---------------------------
    function getOrderData(){ return loadJSON(ORDER_KEY, {}); }
    function setOrderData(data){ saveJSON(ORDER_KEY, data); }
    function getOrder(cat){
      const data = getOrderData();
      return Array.isArray(data[cat]) ? data[cat] : null;
    }
    function setOrder(cat, ids){
      const data = getOrderData();
      data[cat] = ids;
      setOrderData(data);
    }
    function clearOrder(cat){
      const data = getOrderData();
      delete data[cat];
      setOrderData(data);
    }

    // ---------------------------
    // Build items for category
    // ---------------------------
    function getItemsForCat(cat){
      const custom = loadCustom().map(x => ({...x, custom:true}));
      const all = BASE.map(x => ({...x, custom:false})).concat(custom);

      let items = (cat === 'all') ? all : all.filter(x => x.cat === cat);

      const order = getOrder(cat);
      if(order && order.length){
        const map = new Map(items.map(x => [x.id, x]));
        const ordered = [];
        order.forEach(id => { if(map.has(id)) ordered.push(map.get(id)); });
        items.forEach(x => { if(!order.includes(x.id)) ordered.push(x); });
        items = ordered;
      }
      return items;
    }

    // ---------------------------
    // Render grid
    // ---------------------------
    function renderGrid(){
      const items = getItemsForCat(currentCat);

      grid.innerHTML = items.map(item => {
        const menuHidden = item.custom ? '' : 'hidden';
        const draggable = (currentCat === 'all') ? 'false' : 'true';

        return `
          <a class="card" href="${item.href}" target="_blank" rel="noopener"
             data-id="${item.id}" data-cat="${item.cat}" draggable="${draggable}">
            <div class="left">
              <div class="title">${escapeHtml(item.title)}</div>
              <div class="metaRow">
                <div class="sub">${escapeHtml(item.sub || '')}</div>
                ${item.badge ? `<div class="badge" title="${escapeHtml(item.badge)}">${escapeHtml(item.badge)}</div>` : ``}
              </div>
            </div>

            <div class="star" title="ì¦ê²¨ì°¾ê¸°">â˜†</div>
            <div class="menu ${menuHidden}" title="ë‚´ ë§í¬ í¸ì§‘/ì‚­ì œ">â‹¯</div>
          </a>
        `;
      }).join('');

      attachCardHandlers();
      syncStars();
      updateCounts();
    }

    function attachCardHandlers(){
      const cards = Array.from(grid.querySelectorAll('.card'));

      cards.forEach(card => {
        const star = card.querySelector('.star');
        star.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          const item = {
            title: card.querySelector('.title')?.innerText || 'ì¦ê²¨ì°¾ê¸°',
            sub: card.querySelector('.sub')?.innerText || '',
            href: card.getAttribute('href')
          };
          toggleFav(currentCat, item);
        });

        const menu = card.querySelector('.menu');
        if(!menu.classList.contains('hidden')){
          menu.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            const id = card.dataset.id;
            const item = loadCustom().find(x => x.id === id);
            if(item) openLinkModal('edit', item);
          });
        }
      });

      if(currentCat !== 'all') enableCardDrag(cards);
    }

    function syncStars(){
      const anchors = Array.from(grid.querySelectorAll('.card'));
      anchors.forEach(card => {
        const star = card.querySelector('.star');
        const href = card.getAttribute('href');
        const on = isFav(currentCat, href);
        star.classList.toggle('on', on);
        star.textContent = on ? 'â˜…' : 'â˜†';
      });
    }

    function enableCardDrag(cards){
      let draggingEl = null;

      cards.forEach(el => {
        el.addEventListener('dragstart', (e) => {
          draggingEl = el;
          el.classList.add('dragging');
          e.dataTransfer.effectAllowed = 'move';
          e.dataTransfer.setData('text/plain', el.dataset.id);
        });

        el.addEventListener('dragend', () => {
          el.classList.remove('dragging');
          cards.forEach(x => x.classList.remove('dragover'));
          draggingEl = null;
          persistOrderFromDOM();
        });

        el.addEventListener('dragover', (e) => {
          e.preventDefault();
          if(!draggingEl || draggingEl === el) return;
          el.classList.add('dragover');
        });

        el.addEventListener('dragleave', () => el.classList.remove('dragover'));

        el.addEventListener('drop', (e) => {
          e.preventDefault();
          el.classList.remove('dragover');
          if(!draggingEl || draggingEl === el) return;

          const rect = el.getBoundingClientRect();
          const after = (e.clientY - rect.top) > (rect.height / 2);
          if(after) el.insertAdjacentElement('afterend', draggingEl);
          else el.insertAdjacentElement('beforebegin', draggingEl);
        });
      });
    }

    function persistOrderFromDOM(){
      if(currentCat === 'all') return;
      const ids = Array.from(grid.querySelectorAll('.card')).map(x => x.dataset.id);
      setOrder(currentCat, ids);
    }

    // ---------------------------
    // Counts
    // ---------------------------
    function updateCounts(){
      const cats = ['all','comm','prod','media','finance','ai','news','shop','community','dev','util'];
      const allItems = getItemsForCat('all');
      const counts = {};
      cats.forEach(c => counts[c] = 0);

      allItems.forEach(item => {
        counts['all'] += 1;
        if(counts[item.cat] !== undefined) counts[item.cat] += 1;
      });

      cats.forEach(c => {
        const el = document.querySelector(`[data-count="${c}"]`);
        if(el) el.textContent = `(${counts[c]})`;
      });
    }

    // ---------------------------
    // URL state
    // ---------------------------
    function updateUrlStateOnly(){
      const params = new URLSearchParams(location.search);
      if(currentCat === 'all') params.delete('cat');
      else params.set('cat', currentCat);
      const base = location.pathname + (params.toString() ? '?' + params.toString() : '');
      history.replaceState(null,'', base + (location.hash || ''));
    }

    // ---------------------------
    // Category switch
    // ---------------------------
    function setActiveChip(cat){
      chips.forEach(c => c.classList.toggle('active', c.dataset.cat === cat));
      currentCat = cat;
      favScope.textContent = chipLabel(cat);
      updateUrlStateOnly();
      renderGrid();
      renderFav();
    }
    chips.forEach(chip => chip.addEventListener('click', () => setActiveChip(chip.dataset.cat)));

    // ---------------------------
    // Buttons
    // ---------------------------
    function resetAll(){
      naverQ.value = '';
      googleQ.value = '';
      setActiveChip('all');
    }
    resetBtn.addEventListener('click', resetAll);

    resetOrderBtn.addEventListener('click', () => {
      if(currentCat === 'all') return;
      clearOrder(currentCat);
      renderGrid();
    });

    wipeBtn.addEventListener('click', () => {
      if(!confirm('ê°œì¸í™”(ì¦ê²¨ì°¾ê¸°/ì •ë ¬/ë‚´ ë§í¬)ë¥¼ ì „ë¶€ ì´ˆê¸°í™”í• ê¹Œìš”?')) return;
      localStorage.removeItem(FAV_KEY);
      localStorage.removeItem(ORDER_KEY);
      localStorage.removeItem(CUSTOM_KEY);
      localStorage.removeItem(THEME_KEY);
      history.replaceState(null,'', location.pathname + location.search);
      applyTheme('light');
      renderGrid(); renderFav(); syncStars();
    });

    addBtn.addEventListener('click', () => {
      if(currentCat === 'all'){
        openLinkModal('add', {cat:'comm',badge:'ME',title:'',sub:'',href:''});
      }else{
        openLinkModal('add', {cat:currentCat,badge:'ME',title:'',sub:'',href:''});
      }
    });

    // ---------------------------
    // Export / Import
    // ---------------------------
    exportBtn.addEventListener('click', () => {
      const payload = buildPersonalizationPayload();
      const blob = new Blob([JSON.stringify(payload, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'dashboard-personalization.json';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    importBtn.addEventListener('click', () => openImportModal());

    function buildPersonalizationPayload(){
      return {
        v: 1,
        exportedAt: new Date().toISOString(),
        theme: localStorage.getItem(THEME_KEY) || null,
        favorites: loadJSON(FAV_KEY, {}),
        order: loadJSON(ORDER_KEY, {}),
        customLinks: loadCustom(),
      };
    }

    function applyPersonalizationPayload(obj){
      const favorites = obj.favorites ?? {};
      const order = obj.order ?? {};
      const customLinks = obj.customLinks ?? [];
      const theme = obj.theme ?? null;

      if(typeof favorites !== 'object' || typeof order !== 'object' || !Array.isArray(customLinks)) return false;

      const sanitizedCustom = customLinks
        .filter(x => x && typeof x === 'object')
        .map(x => ({
          id: String(x.id || uid()),
          cat: String(x.cat || 'comm'),
          badge: String(x.badge || 'ME').slice(0,10),
          title: String(x.title || '').slice(0,60),
          sub: String(x.sub || '').slice(0,80),
          href: safeUrl(String(x.href || '')) || 'https://example.com'
        }));

      saveJSON(FAV_KEY, favorites);
      saveJSON(ORDER_KEY, order);
      saveJSON(CUSTOM_KEY, sanitizedCustom);

      if(theme === 'dark' || theme === 'light'){
        localStorage.setItem(THEME_KEY, theme);
        applyTheme(theme);
      }
      return true;
    }

    function openImportModal(){
      modalBack.style.display = 'flex';
      editingId = null;
      linkFormArea.style.display = 'none';
      importArea.style.display = 'block';
      modalTitle.textContent = 'ê°œì¸í™” ê°€ì ¸ì˜¤ê¸°';
      modalDesc.textContent = 'JSONì„ ë¶™ì—¬ë„£ê³  ê°€ì ¸ì˜¤ê¸° ì ìš©ì„ ëˆ„ë¥´ì„¸ìš”.';
      importText.value = '';
    }

    function applyImport(jsonText){
      let obj;
      try{ obj = JSON.parse(jsonText); }
      catch{ alert('JSON íŒŒì‹± ì‹¤íŒ¨'); return false; }

      const ok = applyPersonalizationPayload(obj);
      if(!ok){ alert('JSON êµ¬ì¡°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return false; }
      return true;
    }

    applyImportBtn.addEventListener('click', () => {
      const text = (importText.value || '').trim();
      if(!text){ alert('JSONì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.'); return; }
      if(!confirm('ê¸°ì¡´ ê°œì¸í™”ë¥¼ ë®ì–´ì“°ê³  ê°€ì ¸ì˜¤ê² ìŠµë‹ˆê¹Œ?')) return;

      const ok = applyImport(text);
      if(ok){
        closeModal();
        renderGrid(); renderFav(); syncStars();
      }
    });
    importCancelBtn.addEventListener('click', () => closeModal());

    // ---------------------------
    // Share link (compressed)
    // ---------------------------
    shareBtn.addEventListener('click', async () => {
      const payload = buildPersonalizationPayload();
      const json = JSON.stringify(payload);
      const packed = compressToEncodedURIComponent(json);

      const base = location.origin + location.pathname + location.search;
      const shareUrl = base + '#p=' + packed;

      try{
        await navigator.clipboard.writeText(shareUrl);
        alert('ê³µìœ  ë§í¬(ì••ì¶•)ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
      }catch{
        prompt('ê³µìœ  ë§í¬ë¥¼ ë³µì‚¬í•˜ì„¸ìš”:', shareUrl);
      }
    });

    function tryApplyFromHash(){
      const hash = location.hash || '';
      if(!hash.startsWith('#p=')) return;

      const packed = hash.slice(3);
      if(!packed) return;

      const json = decompressFromEncodedURIComponent(packed);
      if (json == null) { alert('ê³µìœ  ë§í¬ í•´ì„ ì‹¤íŒ¨(ì†ìƒë¨).'); return; }

      let obj;
      try{ obj = JSON.parse(json); }
      catch{ alert('ê³µìœ  ë°ì´í„° JSON íŒŒì‹± ì‹¤íŒ¨'); return; }

      const ok = confirm('ê³µìœ  ë§í¬ì˜ ê°œì¸í™”ë¥¼ ì´ ë¸Œë¼ìš°ì €ì— ì ìš©í• ê¹Œìš”? (ê¸°ì¡´ ê°œì¸í™”ëŠ” ë®ì–´ì“°ê¸°)');
      if(!ok) return;

      const applied = applyPersonalizationPayload(obj);
      if(!applied){
        alert('ê³µìœ  ë°ì´í„° êµ¬ì¡°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        return;
      }

      history.replaceState(null,'', location.pathname + location.search);
      renderGrid(); renderFav(); syncStars();
      alert('ì ìš© ì™„ë£Œ');
    }

    // ---------------------------
    // Link modal (add/edit)
    // ---------------------------
    function openLinkModal(mode, item){
      modalBack.style.display = 'flex';
      linkFormArea.style.display = 'block';
      importArea.style.display = 'none';

      editingId = (mode === 'edit') ? item.id : null;

      if(mode === 'edit'){
        modalTitle.textContent = 'ë‚´ ë§í¬ í¸ì§‘';
        modalDesc.textContent = 'ì´ ë§í¬ëŠ” ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.';
        deleteBtn.style.display = 'inline-flex';
      }else{
        modalTitle.textContent = 'ë‚´ ë§í¬ ì¶”ê°€';
        modalDesc.textContent = 'í˜„ì¬ ì„ íƒëœ ì¹´í…Œê³ ë¦¬ì— ì €ì¥ë©ë‹ˆë‹¤.';
        deleteBtn.style.display = 'none';
      }

      fCat.value = item.cat || 'comm';
      fBadge.value = item.badge || 'ME';
      fTitle.value = item.title || '';
      fSub.value = item.sub || '';
      fHref.value = item.href || '';

      if(currentCat !== 'all') fCat.value = currentCat;
    }

    function closeModal(){
      modalBack.style.display = 'none';
      editingId = null;
      fTitle.value = '';
      fSub.value = '';
      fHref.value = '';
      fBadge.value = '';
      importText.value = '';
    }

    function validateForm(){
      const cat = fCat.value;
      const badge = (fBadge.value || '').trim().slice(0,10);
      const title = (fTitle.value || '').trim().slice(0,60);
      const sub = (fSub.value || '').trim().slice(0,80);
      const hrefRaw = (fHref.value || '').trim();

      if(!title) return {ok:false, msg:'ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.'};
      const href = safeUrl(hrefRaw);
      if(!href) return {ok:false, msg:'URLì€ http/https í˜•ì‹ë§Œ í—ˆìš©ë©ë‹ˆë‹¤.'};

      return {ok:true, data:{cat, badge, title, sub, href}};
    }

    saveBtn.addEventListener('click', () => {
      const v = validateForm();
      if(!v.ok){ alert(v.msg); return; }

      const item = v.data;
      if(editingId) upsertCustom({id:editingId, ...item});
      else upsertCustom({id:uid(), ...item});

      closeModal();
      renderGrid();
      updateCounts();
    });

    deleteBtn.addEventListener('click', () => {
      if(!editingId) return;
      if(!confirm('ì´ ë‚´ ë§í¬ë¥¼ ì‚­ì œí• ê¹Œìš”?')) return;
      deleteCustom(editingId);
      closeModal();
      renderGrid();
      updateCounts();
    });

    modalClose.addEventListener('click', closeModal);
    cancelBtn.addEventListener('click', closeModal);
    modalBack.addEventListener('click', (e) => { if(e.target === modalBack) closeModal(); });

    // ---------------------------
    // PWA install button
    // ---------------------------
    let deferredPrompt = null;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'inline-flex';
    });

    installBtn.addEventListener('click', async () => {
      if(!deferredPrompt) return;
      deferredPrompt.prompt();
      try{ await deferredPrompt.userChoice; } catch {}
      deferredPrompt = null;
      installBtn.style.display = 'none';
    });

    // ---------------------------
    // Service Worker register
    // ---------------------------
    async function registerSW(){
      if(!('serviceWorker' in navigator)) return;
      try{ await navigator.serviceWorker.register('./sw.js'); } catch {}
    }

    // ---------------------------
    // Init
    // ---------------------------
    function initChips(){
      const params = new URLSearchParams(location.search);
      const cat = params.get('cat') || 'all';
      const exists = chips.some(c => c.dataset.cat === cat);
      setActiveChip(exists ? cat : 'all');
    }

    window.addEventListener('keydown', (e) => {
      if(e.key === 'Escape'){
        if(modalBack.style.display === 'flex') closeModal();
        else resetAll();
      }
    });

    registerSW();
    initChips();
    renderFav();
    renderGrid();
    tryApplyFromHash();
  </script>
</body>
</html>
